<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Trading — Time Machine | Market Watch</title>
    <link rel="icon" href="https://market-watch.xyz/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Inter',sans-serif; background:#f8fafc; color:#0f172a; padding:0; line-height:1.6; padding-bottom:70px; }
        .container { max-width:1400px; margin:0 auto; padding:1.5rem; }

        /* Cards */
        .mw-card { background:white; border-radius:12px; padding:1.5rem; box-shadow:0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06); border:1px solid #e2e8f0; margin-bottom:2rem; }
        .card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; padding-bottom:0.75rem; border-bottom:2px solid #f1f5f9; }
        .card-title { font-size:1.125rem; font-weight:700; color:#0f172a; display:flex; align-items:center; gap:0.5rem; }

        /* Hero stats */
        .hero-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:1rem; margin-bottom:2rem; }
        .hero-stat { text-align:center; padding:1.25rem; background:white; border:1px solid #e2e8f0; border-radius:12px; box-shadow:0 1px 2px rgba(0,0,0,0.05); }
        .hero-stat .label { font-size:0.7rem; text-transform:uppercase; font-weight:700; color:#94a3b8; letter-spacing:0.5px; margin-bottom:0.25rem; }
        .hero-stat .value { font-size:1.5rem; font-weight:800; color:#0f172a; }
        .hero-stat .value.positive { color:#16a34a; }
        .hero-stat .value.negative { color:#dc2626; }

        /* Stats grid */
        .stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; margin-bottom:2rem; }
        .stat-card { background:white; border:1px solid #e2e8f0; border-radius:12px; padding:1.25rem; box-shadow:0 1px 2px rgba(0,0,0,0.05); }
        .stat-label { font-size:0.7rem; font-weight:600; color:#64748b; text-transform:uppercase; letter-spacing:0.05em; margin-bottom:0.5rem; }
        .stat-value { font-size:1.5rem; font-weight:700; color:#0f172a; }

        /* Table */
        .table-container { overflow-x:auto; margin-top:1rem; }
        table { width:100%; border-collapse:collapse; font-size:0.875rem; }
        thead { background:#f8fafc; border-bottom:2px solid #e2e8f0; }
        th { padding:0.75rem 1rem; text-align:left; font-weight:600; color:#475569; font-size:0.75rem; text-transform:uppercase; letter-spacing:0.05em; }
        td { padding:0.875rem 1rem; border-bottom:1px solid #f1f5f9; }
        tbody tr:hover { background:#f8fafc; }
        .symbol-cell { font-weight:700; color:#0f172a; font-family:'Courier New',monospace; }
        .pnl-positive { color:#16a34a; font-weight:600; }
        .pnl-negative { color:#dc2626; font-weight:600; }

        /* Badges */
        .badge { display:inline-block; padding:0.25rem 0.625rem; border-radius:6px; font-size:0.75rem; font-weight:600; }
        .badge.live { background:#dcfce7; color:#166534; }
        .badge.demo { background:#dbeafe; color:#1e40af; }
        .badge-create { background:#dcfce7; color:#166534; }
        .badge-update { background:#fef3c7; color:#92400e; }
        .badge-cancel { background:#fee2e2; color:#991b1b; }

        /* Charts */
        .chart-container { position:relative; height:300px; margin-top:1rem; }

        /* Grid layouts */
        .grid-2col { display:grid; grid-template-columns:repeat(auto-fit,minmax(500px,1fr)); gap:1.5rem; margin-bottom:1.5rem; }

        /* Empty / Alert */
        .empty { text-align:center; color:#94a3b8; padding:2rem; }
        .alert { padding:1rem; border-radius:8px; margin-bottom:1rem; font-size:0.875rem; }
        .alert.info { background:#dbeafe; color:#1e40af; border-left:4px solid #2563eb; }

        /* Floating footer */
        .floating-footer { position:fixed; bottom:0; left:0; right:0; background:white; border-top:1px solid #e2e8f0; padding:0.75rem 1rem; box-shadow:0 -2px 8px rgba(0,0,0,0.1); z-index:40; display:flex; justify-content:center; align-items:center; }
        .floating-footer-content { display:flex; gap:3rem; align-items:center; justify-content:center; max-width:100%; width:100%; flex-wrap:wrap; }
        .footer-date { font-size:0.75rem; font-weight:700; color:#2563eb; font-family:'Inter',monospace; padding:0.25rem 0.75rem; background:#eff6ff; border-radius:6px; border:1px solid #bfdbfe; }
        .footer-metric { display:flex; flex-direction:column; align-items:center; }
        .footer-metric-label { font-size:0.65rem; text-transform:uppercase; font-weight:700; color:#64748b; letter-spacing:0.5px; margin-bottom:2px; }
        .footer-metric-value { font-size:0.95rem; font-weight:800; color:#0f172a; font-family:'Inter',monospace; }

        /* Scrollbar */
        ::-webkit-scrollbar { width:6px; height:6px; }
        ::-webkit-scrollbar-track { background:transparent; }
        ::-webkit-scrollbar-thumb { background:#cbd5e1; border-radius:3px; }
        ::-webkit-scrollbar-thumb:hover { background:#94a3b8; }

        /* Responsive */
        @media (max-width:768px) {
            .hero-grid { grid-template-columns:repeat(2,1fr) !important; }
            .stats-grid { grid-template-columns:repeat(2,1fr) !important; }
            .grid-2col { grid-template-columns:1fr !important; }
            .floating-footer-content { gap:1rem; }
            .card-header { flex-direction:column; align-items:flex-start !important; gap:0.5rem; }
        }
    </style>
</head>
<body>
    <!-- Navigation bar with currency selector + time machine slider -->
    <nav style="background:white; border-bottom:1px solid #e2e8f0; padding:0.75rem 1.5rem; position:sticky; top:0; z-index:50; box-shadow:0 1px 2px rgba(0,0,0,0.05);">
        <div style="max-width:1400px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap;">
            <div style="display:flex; align-items:center; gap:1rem;">
                <a href="../index.html" style="display:flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#f1f5f9; text-decoration:none;">
                    <i class="fa-solid fa-arrow-left" style="color:#475569; font-size:0.8rem;"></i>
                </a>
                <span id="nav-title" style="font-size:1.1rem; font-weight:800; color:#0f172a;">Live Trading</span>
                <select id="currency-selector" onchange="setGlobalCurrency(this.value)"
                    style="font-size:0.75rem; font-family:monospace; background:#f1f5f9; color:#334155; font-weight:700; padding:4px 8px; border-radius:6px; border:1px solid #e2e8f0; outline:none; cursor:pointer;">
                    <option value="EUR">EUR</option>
                    <option value="USD">USD</option>
                    <option value="CHF">CHF</option>
                    <option value="HKD">HKD</option>
                    <option value="JPY">JPY</option>
                    <option value="CNY">CNY</option>
                    <option value="GBP">GBP</option>
                    <option value="PLN">PLN</option>
                    <option value="BTC">BTC</option>
                    <option value="GOLD">GOLD</option>
                </select>
            </div>
            <div style="display:flex; align-items:center; gap:1rem;">
                <div style="display:flex; flex-direction:column; align-items:flex-end;">
                    <div style="font-size:0.65rem; text-transform:uppercase; font-weight:700; color:#2563eb; letter-spacing:0.5px;">Time Machine</div>
                    <div id="tm-date" style="font-family:monospace; font-size:0.875rem; font-weight:700; color:#334155;">LIVE</div>
                </div>
                <input type="range" id="timeSlider" min="0" max="0" value="0" style="width:10rem; height:6px; accent-color:#2563eb; cursor:pointer;">
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Hero KPI cards -->
        <div class="hero-grid" style="margin-top:1.5rem;">
            <div class="hero-stat">
                <div class="label">Total Return</div>
                <div class="value" id="kpi-return">--</div>
            </div>
            <div class="hero-stat">
                <div class="label">Equity</div>
                <div class="value" id="kpi-equity">--</div>
            </div>
            <div class="hero-stat">
                <div class="label">Positions</div>
                <div class="value" id="kpi-positions" style="color:#8b5cf6;">--</div>
            </div>
            <div class="hero-stat">
                <div class="label">Max Drawdown</div>
                <div class="value negative" id="kpi-dd">--</div>
            </div>
            <div class="hero-stat">
                <div class="label">Unrealized P&amp;L</div>
                <div class="value" id="kpi-pnl">--</div>
            </div>
            <div class="hero-stat">
                <div class="label">Actions</div>
                <div class="value" id="kpi-actions" style="color:#10b981;">--</div>
            </div>
        </div>

        <!-- Cash breakdown -->
        <div class="stats-grid" id="cash-grid"></div>

        <!-- Equity Curve Chart -->
        <div class="mw-card">
            <div class="card-header">
                <div class="card-title"><i class="fas fa-chart-area" style="color:#8b5cf6;"></i> Equity Curve</div>
            </div>
            <div class="chart-container"><canvas id="equityChart"></canvas></div>
        </div>

        <!-- Drawdown Chart -->
        <div class="mw-card">
            <div class="card-header">
                <div class="card-title"><i class="fas fa-chart-line" style="color:#ef4444;"></i> Drawdown</div>
            </div>
            <div class="chart-container"><canvas id="drawdownChart"></canvas></div>
        </div>

        <!-- Positions & Pending Orders -->
        <div class="grid-2col">
            <div class="mw-card" id="positions-card"></div>
            <div class="mw-card" id="pending-card"></div>
        </div>

        <!-- Actions -->
        <div class="mw-card">
            <div class="card-header">
                <div class="card-title"><i class="fas fa-bolt" style="color:#f59e0b;"></i> Actions</div>
            </div>
            <div id="actions-content"></div>
        </div>
    </div>

    <!-- Floating Footer -->
    <div class="floating-footer">
        <div class="floating-footer-content">
            <div class="footer-date" id="footer-date">--</div>
            <div class="footer-metric">
                <div class="footer-metric-label">Positions Value</div>
                <div class="footer-metric-value" id="footer-positions-value">--</div>
            </div>
            <div class="footer-metric">
                <div class="footer-metric-label">Total Equity</div>
                <div class="footer-metric-value" id="footer-total-equity">--</div>
            </div>
            <div class="footer-metric">
                <div class="footer-metric-label">Cash</div>
                <div class="footer-metric-value" id="footer-cash">--</div>
            </div>
            <div class="footer-metric">
                <div class="footer-metric-label">Returns</div>
                <div class="footer-metric-value" id="footer-returns">--</div>
            </div>
            <div class="footer-metric">
                <div class="footer-metric-label">Max Drawdown</div>
                <div class="footer-metric-value" id="footer-drawdown">--</div>
            </div>
        </div>
    </div>

    <script>
    const snapshots = [
  {
    "timestamp": "2026-01-27T22:28:42+01:00",
    "date": "2026-01-26",
    "portfolio": "usa",
    "allocation": "usa",
    "currency": "USD",
    "actions": [
      {
        "type": "UPDATE",
        "symbol": "BLTE",
        "side": "",
        "order_type": "",
        "qty": 0,
        "stop_price": 145.3,
        "order_id": "754d9e63-2d21-4c0e-87ef-71c2ead2ac3b",
        "reason": "TRAILING_STOP_UPDATE"
      },
      {
        "type": "UPDATE",
        "symbol": "CELC",
        "side": "",
        "order_type": "",
        "qty": 0,
        "stop_price": 100.87,
        "order_id": "f7b97695-0ce2-4489-b2b0-b7e1a9207f02",
        "reason": "TRAILING_STOP_UPDATE"
      },
      {
        "type": "UPDATE",
        "symbol": "GH",
        "side": "",
        "order_type": "",
        "qty": 0,
        "stop_price": 103.15,
        "order_id": "d8775636-e22a-461b-b39f-ca5aabe50ecb",
        "reason": "TRAILING_STOP_UPDATE"
      },
      {
        "type": "UPDATE",
        "symbol": "LE",
        "side": "",
        "order_type": "",
        "qty": 0,
        "stop_price": 17.16,
        "order_id": "66016f7c-7075-4bec-8aff-f35421460407",
        "reason": "TRAILING_STOP_UPDATE"
      },
      {
        "type": "UPDATE",
        "symbol": "LYG",
        "side": "",
        "order_type": "",
        "qty": 0,
        "stop_price": 5.57,
        "order_id": "b1c3a0a0-3b61-4d80-b1c6-21ca41700a09",
        "reason": "TRAILING_STOP_UPDATE"
      },
      {
        "type": "UPDATE",
        "symbol": "USAR",
        "side": "",
        "order_type": "",
        "qty": 0,
        "stop_price": 22.88,
        "order_id": "b2cb5903-07a7-4203-b59e-3a134df31b60",
        "reason": "TRAILING_STOP_UPDATE"
      }
    ],
    "positions": [
      {
        "Symbol": "ALM",
        "Qty": 3,
        "AvgEntry": 11.03,
        "CurrentPrice": 11.08,
        "UnrealizedPnL": 0.15,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "AXGN",
        "Qty": 148,
        "AvgEntry": 33.48,
        "CurrentPrice": 35.02,
        "UnrealizedPnL": 227.92,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "BLTE",
        "Qty": 31,
        "AvgEntry": 157.22,
        "CurrentPrice": 167.34,
        "UnrealizedPnL": 313.72,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "CELC",
        "Qty": 46,
        "AvgEntry": 103.925435,
        "CurrentPrice": 117.25,
        "UnrealizedPnL": 612.93,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "CHRW",
        "Qty": 29,
        "AvgEntry": 170.41,
        "CurrentPrice": 180.425,
        "UnrealizedPnL": 290.435,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "DVAX",
        "Qty": 21,
        "AvgEntry": 15.49,
        "CurrentPrice": 15.48,
        "UnrealizedPnL": -0.21,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "FOLD",
        "Qty": 820,
        "AvgEntry": 14.29,
        "CurrentPrice": 14.28,
        "UnrealizedPnL": -8.2,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "GH",
        "Qty": 45,
        "AvgEntry": 109.17,
        "CurrentPrice": 114.59,
        "UnrealizedPnL": 243.9,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "KRYS",
        "Qty": 19,
        "AvgEntry": 261.4,
        "CurrentPrice": 277.36,
        "UnrealizedPnL": 303.24,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "LCII",
        "Qty": 38,
        "AvgEntry": 131,
        "CurrentPrice": 148.05,
        "UnrealizedPnL": 647.9,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "LE",
        "Qty": 20,
        "AvgEntry": 19.06,
        "CurrentPrice": 19.15,
        "UnrealizedPnL": 1.8,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "LYG",
        "Qty": 2060,
        "AvgEntry": 5.84,
        "CurrentPrice": 5.95,
        "UnrealizedPnL": 226.6,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "OLMA",
        "Qty": 176,
        "AvgEntry": 27.95483,
        "CurrentPrice": 25.0263,
        "UnrealizedPnL": -515.4212,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "PRAX",
        "Qty": 17,
        "AvgEntry": 282.55,
        "CurrentPrice": 314.75,
        "UnrealizedPnL": 547.4,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "REAL",
        "Qty": 301,
        "AvgEntry": 16.2,
        "CurrentPrice": 16.11,
        "UnrealizedPnL": -27.09,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "SATS",
        "Qty": 41,
        "AvgEntry": 119.988293,
        "CurrentPrice": 125.81,
        "UnrealizedPnL": 238.69,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "Symbol": "USAR",
        "Qty": 139,
        "AvgEntry": 26.94,
        "CurrentPrice": 26.35,
        "UnrealizedPnL": -82.01,
        "Currency": "USD",
        "Timestamp": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      }
    ],
    "pending_orders": [
      {
        "OrderID": "dc175759-1a23-41b0-842e-b9c6682c708f",
        "Symbol": "USAR",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 139,
        "LimitPrice": 0,
        "StopPrice": 22.88,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T21:24:48.780265706Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "86f50f6d-22d3-4e57-bfa6-cb613e6f062c",
        "Symbol": "LYG",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 2060,
        "LimitPrice": 0,
        "StopPrice": 5.57,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T21:24:48.689442847Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "606e2c10-8718-4c20-a551-9442742a2848",
        "Symbol": "LE",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 20,
        "LimitPrice": 0,
        "StopPrice": 17.16,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T21:24:48.600613328Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "655fff71-76d9-4f19-bb8b-c70c4ca6304d",
        "Symbol": "GH",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 45,
        "LimitPrice": 0,
        "StopPrice": 103.15,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T21:24:48.508327139Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "178875e7-4936-4a8f-b56c-37a9314df4dc",
        "Symbol": "CELC",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 46,
        "LimitPrice": 0,
        "StopPrice": 100.87,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T21:24:48.41997755Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "862807f8-24c7-4105-bf1f-8b718feac9d7",
        "Symbol": "BLTE",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 31,
        "LimitPrice": 0,
        "StopPrice": 145.3,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T21:24:48.329945981Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "50afd341-509a-4683-a69b-63181fb0e4b6",
        "Symbol": "HSBC",
        "Side": "BUY",
        "OrderType": "LIMIT",
        "Qty": 36,
        "LimitPrice": 87.64,
        "StopPrice": 0,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:29.029564Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "fb7b0978-1f69-4193-9563-eeb57995f7d1",
        "Symbol": "TMQ",
        "Side": "BUY",
        "OrderType": "LIMIT",
        "Qty": 1800,
        "LimitPrice": 6.72,
        "StopPrice": 0,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:28.919584Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "5c757b1f-f8ad-499e-bb0f-ebe45e391007",
        "Symbol": "PRAX",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 17,
        "LimitPrice": 0,
        "StopPrice": 253.97,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:28.716419Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "9343f5a8-1e5a-4615-941e-42857569f64a",
        "Symbol": "LCII",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 38,
        "LimitPrice": 0,
        "StopPrice": 137.76,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:28.435112Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "24ea3fdb-6308-43af-94e3-af2cc95d10b9",
        "Symbol": "KRYS",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 19,
        "LimitPrice": 0,
        "StopPrice": 253.02,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:28.321972Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "d8775636-e22a-461b-b39f-ca5aabe50ecb",
        "Symbol": "GH",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 45,
        "LimitPrice": 0,
        "StopPrice": 103.14,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:28.222516Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "f55f9b94-831e-43d2-80cf-11e7505eed97",
        "Symbol": "FOLD",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 820,
        "LimitPrice": 0,
        "StopPrice": 14.19,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:28.114239Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "6a80fc9b-6661-4d2d-a84c-78eac8091d93",
        "Symbol": "DVAX",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 21,
        "LimitPrice": 0,
        "StopPrice": 15.34,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:28.030571Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "57b679ca-9401-45ce-aeb9-fe3c728f542c",
        "Symbol": "CHRW",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 29,
        "LimitPrice": 0,
        "StopPrice": 170.66,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:27.913728Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "f7b97695-0ce2-4489-b2b0-b7e1a9207f02",
        "Symbol": "CELC",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 46,
        "LimitPrice": 0,
        "StopPrice": 100.86,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:27.810384Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "754d9e63-2d21-4c0e-87ef-71c2ead2ac3b",
        "Symbol": "BLTE",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 31,
        "LimitPrice": 0,
        "StopPrice": 145.29,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:27.690528Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "2d216280-5df8-4363-96e8-d3646c1bad6e",
        "Symbol": "AXGN",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 148,
        "LimitPrice": 0,
        "StopPrice": 31.42,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:53:27.591897Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "4c1bfdd3-7c7f-4114-a4a0-8c39542a0b5a",
        "Symbol": "TRX",
        "Side": "BUY",
        "OrderType": "LIMIT",
        "Qty": 8441,
        "LimitPrice": 1.43,
        "StopPrice": 0,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:42:14.920305Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "545eba4e-8b60-48b7-a082-370a792f2d1a",
        "Symbol": "ALM",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 3,
        "LimitPrice": 0,
        "StopPrice": 10.52,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:32:28.45138Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "b1c3a0a0-3b61-4d80-b1c6-21ca41700a09",
        "Symbol": "LYG",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 2060,
        "LimitPrice": 0,
        "StopPrice": 5.56,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:32:27.405158Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "66016f7c-7075-4bec-8aff-f35421460407",
        "Symbol": "LE",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 20,
        "LimitPrice": 0,
        "StopPrice": 17.15,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:28:05.402176Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "b2cb5903-07a7-4203-b59e-3a134df31b60",
        "Symbol": "USAR",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 139,
        "LimitPrice": 0,
        "StopPrice": 22.87,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-27T20:28:03.824651Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "1519fceb-a3b3-494c-a8a7-0c8b93620de0",
        "Symbol": "SATS",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 41,
        "LimitPrice": 0,
        "StopPrice": 107.69,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-21T17:34:13.442575Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "17f995a5-3f60-4aa6-9d85-bb9b60e864a0",
        "Symbol": "OLMA",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 176,
        "LimitPrice": 0,
        "StopPrice": 23.33,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-12T14:32:11.443574Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      },
      {
        "OrderID": "194fc8ed-aa0d-4fd5-873b-fd11421a4258",
        "Symbol": "REAL",
        "Side": "SELL",
        "OrderType": "STOP",
        "Qty": 301,
        "LimitPrice": 0,
        "StopPrice": 14.63,
        "ExpectedPrice": 0,
        "Status": "PENDING",
        "Currency": "",
        "PlacedDate": "2026-01-12T14:30:43.992208Z",
        "ExpirationDate": "0001-01-01T00:00:00Z",
        "BrokerSource": ""
      }
    ],
    "balance": {
      "BaseCurrency": "USD",
      "CashByCurrency": {
        "USD": 15645.42
      },
      "AvailableCashByCurrency": null,
      "MarginUsed": 85181.88,
      "TotalEquity": 100827.3,
      "Timestamp": "0001-01-01T00:00:00Z",
      "BrokerSource": "alpaca"
    },
    "state": {
      "pm_state": {
        "equity_curve": [
          100720.26,
          100650.13,
          100708.92,
          100771.04,
          100720.65,
          100787.15,
          100827.3
        ],
        "equity_curve_dates": [
          "2026-01-26T21:59:49+01:00",
          "2026-01-26T22:00:01+01:00",
          "2026-01-26T22:00:02+01:00",
          "2026-01-26T21:59:59+01:00",
          "2026-01-26T22:00:01+01:00",
          "2026-01-26T15:30:00+01:00",
          "2026-01-26T15:30:00+01:00"
        ],
        "global_pause_until": "0001-01-01T00:00:00Z",
        "is_in_grace_period": false,
        "last_liquidation_date": "0001-01-01T00:00:00Z",
        "last_streak_reset_date": "0001-01-01T00:00:00Z",
        "peak_equity": 100827.3,
        "position_entries": {
          "ALM": 1,
          "DVAX": 1,
          "FOLD": 1,
          "HSBC": 1,
          "LE": 1,
          "LYG": 1,
          "TMQ": 1,
          "TRX": 1,
          "USAR": 1
        },
        "position_last_dca": {
          "ALM": "2026-01-26T22:00:01+01:00",
          "DVAX": "2026-01-26T22:00:01+01:00",
          "FOLD": "2026-01-26T22:00:01+01:00",
          "HSBC": "2026-01-26T21:59:59+01:00",
          "LE": "2026-01-26T21:59:49+01:00",
          "LYG": "2026-01-26T22:00:01+01:00",
          "TMQ": "2026-01-26T21:59:59+01:00",
          "TRX": "2026-01-26T22:00:02+01:00",
          "USAR": "2026-01-26T21:59:49+01:00"
        },
        "position_stops": {
          "ALM": 10.52,
          "AXGN": 31.42,
          "BLTE": 145.29100472586495,
          "CELC": 100.86185782296317,
          "CHRW": 170.66,
          "DVAX": 15.34,
          "FOLD": 14.19,
          "GH": 103.1449955531529,
          "HSBC": 83.48991019913862,
          "KRYS": 253.02,
          "LCII": 137.76,
          "LE": 17.154604416268686,
          "LYG": 5.564636974595349,
          "OLMA": 23.33,
          "PRAX": 253.97,
          "REAL": 14.63,
          "SATS": 107.69,
          "TMQ": 5.862546414742003,
          "TRX": 1.2550762985406931,
          "USAR": 22.870998632382673
        },
        "regime_score_history": [
          0.7071500258411052,
          0.7071500258411052,
          0.7071500258411052,
          0.7054001648394572,
          0.7054001648394572
        ],
        "stop_history": [],
        "stop_streak_count": 0,
        "stopped_symbols": {}
      },
      "prev_regime": "RECOVERY"
    }
  }
];
    let currentIdx = snapshots.length - 1;
    let equityChartInst = null;
    let ddChartInst = null;

    // ─── CURRENCY STATE ───
    let displayCurrency = null; // null = native (from snapshot)

    function getNativeCcy() {
        if(!snapshots.length) return 'USD';
        const s = snapshots[currentIdx];
        return s.currency || (s.balance ? s.balance.BaseCurrency : '') || 'USD';
    }
    function getDisplayCcy() {
        return displayCurrency || getNativeCcy();
    }

    // ─── CURRENCY FORMATTING (Intl.NumberFormat like original template) ───
    const fmtMoney = (v, ccy) => {
        if(v == null || isNaN(v)) return '-';
        const c = ccy || getDisplayCcy();
        if(c === 'BTC') return '\u20bf ' + v.toFixed(6);
        if(c === 'GOLD') return v.toFixed(2) + ' oz';
        try {
            return new Intl.NumberFormat('en-US', { style:'currency', currency:c, minimumFractionDigits:2, maximumFractionDigits:2 }).format(v);
        } catch(e) {
            return c + ' ' + Number(v).toLocaleString('en',{minimumFractionDigits:2,maximumFractionDigits:2});
        }
    };
    function fmtPct(v) { return v != null ? v.toFixed(2) + '%' : '-'; }
    function pnlCls(v) { return v >= 0 ? 'pnl-positive' : 'pnl-negative'; }

    function setGlobalCurrency(c) {
        displayCurrency = c;
        // Note: no FX conversion in live mode — values stay in native currency,
        // display label changes. For true conversion, FX history would be needed.
        renderAll();
        renderCharts();
    }

    // Set initial currency selector to match snapshot
    function initCurrencySelector() {
        const sel = document.getElementById('currency-selector');
        const native = getNativeCcy();
        sel.value = native;
        displayCurrency = native;
    }

    // ─── TIME MACHINE SLIDER ───
    function initSlider() {
        const slider = document.getElementById('timeSlider');
        slider.max = snapshots.length - 1;
        slider.value = currentIdx;
        slider.addEventListener('input', function() {
            currentIdx = parseInt(this.value);
            renderAll();
            updateSliderLabel();
            updateChartHighlight();
        });
    }
    function updateSliderLabel() {
        const s = snapshots[currentIdx];
        document.getElementById('tm-date').textContent = s ? s.date : 'LIVE';
        document.getElementById('timeSlider').value = currentIdx;
    }
    function selectDate(idx) {
        currentIdx = idx;
        document.getElementById('timeSlider').value = idx;
        renderAll();
        updateSliderLabel();
        updateChartHighlight();
    }

    // ─── KPI HERO STATS ───
    function renderKPIs() {
        if(!snapshots.length) return;
        const s = snapshots[currentIdx];
        const bal = s.balance || {};

        // Unrealized PnL
        let totalPnL = 0;
        if(s.positions) s.positions.forEach(p => { totalPnL += (p.UnrealizedPnL || 0); });

        // Return & drawdown from equity curve
        const equities = snapshots.map(sn => sn.balance ? sn.balance.TotalEquity : 0).filter(v => v > 0);
        const totalReturn = equities.length >= 2 ? ((equities[equities.length-1] / equities[0]) - 1) * 100 : 0;
        let peak = 0, maxDD = 0;
        equities.forEach(eq => { if(eq > peak) peak = eq; const dd = peak > 0 ? (peak-eq)/peak*100 : 0; if(dd > maxDD) maxDD = dd; });

        // KPI cards
        const retEl = document.getElementById('kpi-return');
        retEl.textContent = fmtPct(totalReturn);
        retEl.className = 'value ' + (totalReturn >= 0 ? 'positive' : 'negative');

        document.getElementById('kpi-equity').textContent = fmtMoney(bal.TotalEquity);
        document.getElementById('kpi-positions').textContent = s.positions ? s.positions.length : 0;

        document.getElementById('kpi-dd').textContent = '-' + fmtPct(maxDD);

        const pnlEl = document.getElementById('kpi-pnl');
        pnlEl.textContent = fmtMoney(totalPnL);
        pnlEl.className = 'value ' + (totalPnL >= 0 ? 'positive' : 'negative');

        document.getElementById('kpi-actions').textContent = s.actions ? s.actions.length : 0;

        // Nav title
        document.getElementById('nav-title').textContent = 'Live Trading — ' + (s.portfolio || '').toUpperCase();

        // Cash breakdown
        const ccy = getDisplayCcy();
        let cashHtml = '';
        if(bal.CashByCurrency) {
            for(const [c,amt] of Object.entries(bal.CashByCurrency)) {
                cashHtml += '<div class="stat-card" style="border-left:4px solid #3b82f6;"><div class="stat-label">Cash ('+c+')</div><div class="stat-value" style="color:#3b82f6;">'+fmtMoney(amt,c)+'</div></div>';
            }
        }
        document.getElementById('cash-grid').innerHTML = cashHtml;

        // Floating footer
        document.getElementById('footer-date').textContent = s.date;
        let posValue = 0;
        if(s.positions) s.positions.forEach(p => { posValue += (p.CurrentPrice||0) * (p.Qty||0); });
        document.getElementById('footer-positions-value').textContent = fmtMoney(posValue);
        document.getElementById('footer-total-equity').textContent = fmtMoney(bal.TotalEquity);
        const mainCash = bal.CashByCurrency ? (bal.CashByCurrency[getNativeCcy()] || 0) : 0;
        document.getElementById('footer-cash').textContent = fmtMoney(mainCash);
        const retFooter = document.getElementById('footer-returns');
        retFooter.textContent = fmtPct(totalReturn);
        retFooter.style.color = totalReturn >= 0 ? '#16a34a' : '#dc2626';
        const ddFooter = document.getElementById('footer-drawdown');
        ddFooter.textContent = '-' + fmtPct(maxDD);
        ddFooter.style.color = '#dc2626';
    }

    // ─── CHARTS ───
    function renderCharts() {
        const equities = [], dates = [], drawdowns = [];
        let peak = 0;

        snapshots.forEach(s => {
            const eq = s.balance ? s.balance.TotalEquity : 0;
            if(eq <= 0) return;
            dates.push(s.date);
            equities.push(eq);
            if(eq > peak) peak = eq;
            drawdowns.push(peak > 0 ? -((peak-eq)/peak*100) : 0);
        });

        if(equities.length < 2) {
            document.getElementById('equityChart').parentElement.innerHTML = '<div class="alert info"><i class="fas fa-info-circle"></i> Not enough data for charts. Run the pipeline multiple times to build history.</div>';
            return;
        }

        const ccy = getDisplayCcy();

        // Equity
        if(equityChartInst) equityChartInst.destroy();
        equityChartInst = new Chart(document.getElementById('equityChart').getContext('2d'), {
            type:'line',
            data:{ labels:dates, datasets:[{
                label:'Equity ('+ccy+')', data:equities, borderColor:'#2563eb',
                backgroundColor:'rgba(37,99,235,0.1)', fill:true, tension:0.3,
                pointRadius:dates.map((_,i)=>i===currentIdx?6:1),
                pointBackgroundColor:dates.map((_,i)=>i===currentIdx?'#ef4444':'#2563eb'),
                pointBorderColor:dates.map((_,i)=>i===currentIdx?'#ef4444':'#2563eb'),
                borderWidth:2
            }]},
            options:{
                responsive:true, maintainAspectRatio:false,
                plugins:{ legend:{position:'top'} },
                scales:{
                    y:{ beginAtZero:false, ticks:{ callback:v=>fmtMoney(v) } },
                    x:{ ticks:{ maxTicksLimit:15, font:{size:10} } }
                },
                onClick:(e,els)=>{ if(els.length) selectDate(els[0].index); }
            }
        });

        // Drawdown
        if(ddChartInst) ddChartInst.destroy();
        ddChartInst = new Chart(document.getElementById('drawdownChart').getContext('2d'), {
            type:'line',
            data:{ labels:dates, datasets:[{
                label:'Drawdown', data:drawdowns, borderColor:'#ef4444',
                backgroundColor:'rgba(239,68,68,0.1)', fill:true, tension:0.3,
                pointRadius:1, borderWidth:2
            }]},
            options:{
                responsive:true, maintainAspectRatio:false,
                plugins:{ legend:{display:false} },
                scales:{
                    y:{ max:0, ticks:{ callback:v=>v.toFixed(1)+'%' } },
                    x:{ ticks:{ maxTicksLimit:15, font:{size:10} } }
                }
            }
        });
    }

    function updateChartHighlight() {
        if(!equityChartInst) return;
        const n = equityChartInst.data.labels.length;
        equityChartInst.data.datasets[0].pointRadius = Array.from({length:n},(_,i)=>i===currentIdx?6:1);
        equityChartInst.data.datasets[0].pointBackgroundColor = Array.from({length:n},(_,i)=>i===currentIdx?'#ef4444':'#2563eb');
        equityChartInst.data.datasets[0].pointBorderColor = Array.from({length:n},(_,i)=>i===currentIdx?'#ef4444':'#2563eb');
        equityChartInst.update('none');
    }

    // ─── POSITIONS (with STOP orders merged in) ───
    function renderPositions() {
        const s = snapshots[currentIdx];
        const positions = s ? s.positions : [];
        const pending = s ? s.pending_orders : [];
        const stopMap = {};
        for(const o of (pending||[])) {
            if(o.Side==='SELL' && (o.OrderType==='STOP'||o.OrderType==='TRAILING_STOP'||o.OrderType==='STOP_LIMIT') && o.StopPrice>0) {
                stopMap[o.Symbol] = o.StopPrice;
            }
        }
        let html = '<div class="card-header"><div class="card-title"><i class="fas fa-chart-line" style="color:#3b82f6;"></i> Positions Ouvertes</div><div class="badge live">'+positions.length+'</div></div>';
        if(positions && positions.length > 0) {
            const sorted = [...positions].sort((a,b)=>(b.UnrealizedPnL||0)-(a.UnrealizedPnL||0));
            html += '<div class="table-container"><table><thead><tr><th>Symbol</th><th>Qty</th><th>Entry</th><th>Current</th><th>Stop</th><th>Value</th><th>P&L</th><th>P&L %</th></tr></thead><tbody>';
            for(const p of sorted) {
                const pnl = p.UnrealizedPnL || 0;
                const pct = p.AvgEntry > 0 ? ((p.CurrentPrice-p.AvgEntry)/p.AvgEntry*100) : 0;
                const cls = pnlCls(pnl);
                const stop = stopMap[p.Symbol] || 0;
                const stopStr = stop > 0 ? fmtMoney(stop) : '-';
                const riskPct = (stop > 0 && p.CurrentPrice > 0) ? ((p.CurrentPrice-stop)/p.CurrentPrice*100).toFixed(1)+'%' : '';
                html += '<tr><td class="symbol-cell">'+p.Symbol+'</td><td>'+p.Qty+'</td>';
                html += '<td>'+fmtMoney(p.AvgEntry)+'</td><td>'+fmtMoney(p.CurrentPrice)+'</td>';
                html += '<td>'+(stop>0?stopStr+' <small style="color:#94a3b8;">('+riskPct+')</small>':'-')+'</td>';
                html += '<td>'+fmtMoney(p.CurrentPrice*p.Qty)+'</td>';
                html += '<td class="'+cls+'">'+fmtMoney(pnl)+'</td>';
                html += '<td class="'+cls+'">'+pct.toFixed(2)+'%</td></tr>';
            }
            html += '</tbody></table></div>';
        } else { html += '<p class="empty">No open positions</p>'; }
        document.getElementById('positions-card').innerHTML = html;
    }

    // ─── PENDING ORDERS (excluding STOP orders merged into positions) ───
    function renderPending() {
        const s = snapshots[currentIdx];
        const pending = s ? s.pending_orders : [];
        const positions = s ? s.positions : [];
        const posSymbols = new Set((positions||[]).map(p=>p.Symbol));
        const filtered = (pending||[]).filter(o => {
            if(o.Side==='SELL' && (o.OrderType==='STOP'||o.OrderType==='TRAILING_STOP'||o.OrderType==='STOP_LIMIT') && posSymbols.has(o.Symbol)) return false;
            return true;
        });
        let html = '<div class="card-header"><div class="card-title"><i class="fas fa-clock" style="color:#f59e0b;"></i> Ordres en Attente</div><div class="badge demo">'+filtered.length+'</div></div>';
        if(filtered.length > 0) {
            html += '<div class="table-container"><table><thead><tr><th>Symbol</th><th>Side</th><th>Type</th><th>Qty</th><th>Limit</th><th>Stop</th><th>Status</th></tr></thead><tbody>';
            for(const o of filtered) {
                const cls = o.Side==='BUY'?'pnl-positive':'pnl-negative';
                html += '<tr><td class="symbol-cell">'+o.Symbol+'</td><td class="'+cls+'">'+o.Side+'</td>';
                html += '<td>'+o.OrderType+'</td><td>'+o.Qty+'</td>';
                html += '<td>'+fmtMoney(o.LimitPrice)+'</td><td>'+fmtMoney(o.StopPrice)+'</td>';
                html += '<td>'+(o.Status||'-')+'</td></tr>';
            }
            html += '</tbody></table></div>';
        } else { html += '<p class="empty">No pending orders</p>'; }
        document.getElementById('pending-card').innerHTML = html;
    }

    // ─── ACTIONS ───
    function renderActions() {
        const s = snapshots[currentIdx];
        const actions = s ? s.actions : [];
        let html = '';
        if(actions && actions.length > 0) {
            html += '<div class="table-container"><table><thead><tr><th>Type</th><th>Symbol</th><th>Side</th><th>Qty</th><th>Limit</th><th>Stop</th><th>SL</th><th>Reason</th></tr></thead><tbody>';
            for(const a of actions) {
                const badge = a.type==='CREATE'?'badge-create':a.type==='UPDATE'?'badge-update':'badge-cancel';
                const cls = a.side==='BUY'?'pnl-positive':'pnl-negative';
                html += '<tr><td><span class="badge '+badge+'">'+a.type+'</span></td>';
                html += '<td class="symbol-cell">'+a.symbol+'</td><td class="'+cls+'">'+(a.side||'-')+'</td>';
                html += '<td>'+(a.qty||'-')+'</td><td>'+fmtMoney(a.limit_price)+'</td>';
                html += '<td>'+fmtMoney(a.stop_price)+'</td><td>'+fmtMoney(a.stop_loss)+'</td>';
                html += '<td>'+(a.reason||'-')+'</td></tr>';
            }
            html += '</tbody></table></div>';
        } else { html += '<p class="empty">No actions for this date</p>'; }
        document.getElementById('actions-content').innerHTML = html;
    }

    // ─── RENDER ALL ───
    function renderAll() {
        renderKPIs();
        renderPositions();
        renderPending();
        renderActions();
    }

    // ─── INIT ───
    if(snapshots.length === 0) {
        document.querySelector('.container').innerHTML = '<div class="mw-card"><div class="alert info"><i class="fas fa-info-circle"></i> No snapshots yet. Run <code>./run.sh -apply -config config/portfolio_us.yaml</code> to generate data.</div></div>';
    } else {
        initCurrencySelector();
        initSlider();
        updateSliderLabel();
        renderAll();
        renderCharts();
    }
    </script>
</body>
</html>
